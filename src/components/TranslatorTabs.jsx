import { message } from 'antd'
import React from 'react'

const TranslatorTabs = ({
  translators,
  enabledTranslators,
  selectedTranslator,
  onTranslatorChange,
  showSettings,
}) => {
  const getOrderedTranslators = () => {
    if (
      !translators ||
      !enabledTranslators ||
      Object.keys(translators).length === 0
    ) {
      return []
    }

    // 过滤出启用的翻译器
    const filtered = Object.entries(translators).filter(([key]) =>
      enabledTranslators.includes(key)
    )

    return filtered
  }

  const orderedTranslators = getOrderedTranslators()

  // 处理翻译器点击
  const handleTranslatorClick = (key, name, needsConfig, isConfigured) => {
    // 如果需要配置API但未配置，显示提示消息
    if (needsConfig && !isConfigured) {
      message.warning(`请先在设置中配置${name}的API密钥`)
      showSettings('translators')
      return
    }

    onTranslatorChange(key)
  }

  // 渲染翻译器图标
  const renderTranslatorIcon = (key, name) => {
    let icon = null

    switch (key) {
      case 'glm':
        icon = (
          <svg viewBox='0 0 1024 1024' width='24' height='24'>
            <path
              d='M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z'
              fill='#1890ff'
            />
            <path
              d='M512 256c-141.4 0-256 114.6-256 256s114.6 256 256 256 256-114.6 256-256-114.6-256-256-256z m0 448c-106 0-192-86-192-192s86-192 192-192 192 86 192 192-86 192-192 192z'
              fill='#ffffff'
            />
            <path
              d='M512 384c-70.7 0-128 57.3-128 128s57.3 128 128 128 128-57.3 128-128-57.3-128-128-128z'
              fill='#ffffff'
            />
          </svg>
        )
        break
      case 'caiyun':
        icon = (
          <svg viewBox='0 0 1024 1024' width='24' height='24'>
            <path
              d='M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z'
              fill='#1890ff'
            ></path>
            <path
              d='M713.5 378c-30.9-30.9-79.4-37.9-118.2-17-14.3 7.7-25.5 18.9-33.4 31.9-8-12.9-19.1-24.2-33.4-31.9-38.7-20.9-87.2-13.9-118.2 17-35.3 35.3-38.8 90.5-10.6 130.2L512 660.8l112.2-152.6c28.3-39.7 24.8-95-10.7-130.2z'
              fill='#ffffff'
            ></path>
          </svg>
        )
        break
      case 'deepl':
        icon = (
          <svg viewBox='0 0 1024 1024' width='24' height='24'>
            <path
              d='M512 0C229.12 0 0 229.12 0 512s229.12 512 512 512 512-229.12 512-512S794.88 0 512 0z m0 962.56c-248.32 0-450.56-202.24-450.56-450.56S263.68 61.44 512 61.44 962.56 263.68 962.56 512 760.32 962.56 512 962.56z'
              fill='#0F2B46'
            ></path>
            <path
              d='M503.13 333.29h53.04v360.25h-53.04V333.29zM308.54 406.1L232.1 620.25h-6.75L148.9 406.1h59.35l26.25 132.71c1.55 8.15 3.15 18.15 4.65 30.1 1.55 11.9 2.55 20.4 3 25.4h1.5c0.5-4.75 1.4-12.9 2.9-24.4 1.3-10.6 2.85-20.75 4.65-30.35L280.99 406.1h27.55z m210.16 214.16h-50.6c-5.55 0-9.6-1.35-12.45-4.1-2.7-2.75-4.15-6.65-4.15-11.8v-0.4c-2.45 2.65-5.15 5.05-8.1 7.25-2.95 2.2-6.25 4.05-9.85 5.65-3.6 1.55-7.55 2.75-11.85 3.6-4.25 0.8-8.95 1.25-14.05 1.25-6.3 0-12.15-0.9-17.6-2.7-5.4-1.8-10.15-4.5-14.2-8.05-4.05-3.55-7.25-7.95-9.55-13.3-2.3-5.3-3.45-11.4-3.45-18.35 0-5.3 0.9-10.25 2.75-14.9 1.85-4.65 4.7-8.85 8.6-12.55 3.9-3.75 8.85-6.95 14.8-9.65 5.95-2.7 13.05-4.75 21.3-6.15 8.3-1.45 17.8-2.25 28.6-2.4 10.75-0.2 22.9-0.25 36.4-0.25v-8.2c0-10.95-2.35-19.25-7.05-24.8-4.75-5.6-11.95-8.4-21.7-8.4-7.2 0-12.95 0.95-17.25 2.85-4.35 1.9-7.85 4.05-10.55 6.55-2.7 2.45-4.9 4.75-6.65 6.8-1.75 2.1-3.35 3.1-4.85 3.1-0.9 0-1.8-0.2-2.7-0.6-0.95-0.4-1.8-0.95-2.55-1.65l-9.9-13.55c9.85-9.2 20.35-15.7 31.5-19.45 11.15-3.7 22.65-5.55 34.5-5.55 8.45 0 16.3 1.35 23.5 4.05 7.25 2.7 13.5 6.6 18.75 11.75 5.25 5.1 9.35 11.45 12.3 19 2.95 7.6 4.45 16.2 4.45 25.9v103.85h0.05z m-51.5-21.05V586c-13.8 0.05-24.95 0.45-33.55 1.2-8.6 0.75-15.3 1.9-20.1 3.45-4.8 1.55-8.2 3.5-10.15 5.9-1.95 2.45-2.95 5.25-2.95 8.4 0 6 1.8 10.3 5.35 12.75 3.6 2.5 8.3 3.7 14.25 3.7 8.1 0 15.1-1.45 20.95-4.35 5.9-2.9 11-6.7 15.35-11.5 4.35-4.75 7.8-10.1 10.4-16.05l0.45 9.7z m227.25-93.85c-5.7-3.9-11.35-6.85-17-8.85-5.7-2-11.6-3-17.75-3-9.55 0-16.95 2.9-22.25 8.65-5.35 5.75-8 13.75-8 24.05v93.05h-49.25V452.6h30.05c3.1 0 5.7 0.35 7.75 1.05 2.05 0.7 3.7 2.6 4.95 5.65l3.25 9.9c3.75-2.7 7.5-5.2 11.15-7.45 3.65-2.25 7.4-4.2 11.3-5.85 3.9-1.65 8-2.95 12.3-3.85 4.3-0.95 9-1.4 14.05-1.4 3.35 0 6.75 0.3 10.15 0.9 3.4 0.55 6.7 1.45 9.95 2.7l-0.65 30.5c-1.65 1-3.45 1.5-5.45 1.5-1.5 0-3.35-0.35-5.55-1.05-3.2-1.05-6.05-2.2-8.65-3.4z m219.05 33.9c-2.85 2.6-5.75 4.9-8.65 6.9-2.95 2-6.05 3.7-9.3 5.05-3.25 1.4-6.75 2.45-10.5 3.15-3.75 0.75-7.95 1.1-12.6 1.1-14.65 0-25.9-3.85-33.75-11.6-7.85-7.75-11.75-19.2-11.75-34.4v-68.75h-15.05c-2.65 0-4.85-0.8-6.6-2.45-1.8-1.6-2.65-3.9-2.65-6.8v-14.8H602l4.8-40.45c0.5-2.6 1.6-4.7 3.4-6.25 1.8-1.55 4.1-2.35 6.85-2.35h20.45v49.05h38.75v24.25h-38.75V529c0 5.45 1.3 9.65 3.9 12.75 2.6 3.05 6.35 4.6 11.25 4.6 2.7 0 4.95-0.3 6.8-0.95 1.85-0.65 3.45-1.35 4.8-2.05 1.35-0.7 2.55-1.4 3.55-2.05 1-0.65 2-0.95 2.95-0.95 1.25 0 2.25 0.3 3 0.95 0.75 0.65 1.55 1.55 2.3 2.7l11.15 18.25c-5.5 4.3-11.75 7.85-18.75 10.7-7 2.85-14.35 4.25-22.05 4.25a50.68 50.68 0 0 1-17.65-3c-5.55-1.95-10.4-4.95-14.65-8.85-4.2-3.95-7.55-8.9-10-14.95-2.45-6-3.65-13.05-3.65-21.05v-68.75h-14.05v-24.25h14.05v-2.45-5.7l-0.2-9.25-0.4-10.9-0.4-10.6-0.25-8.55h50.25v48h38.75v24.25h-38.75v58.65c0 9.05 4.35 13.6 13.1 13.6 2.85 0 5.3-0.5 7.25-1.5 1.95-1 3.65-2.1 5.05-3.3 1.45-1.25 2.65-2.35 3.55-3.3 0.95-0.95 1.85-1.45 2.65-1.45 1.35 0 2.7 0.7 4.05 2.05l10.6 17.4z'
              fill='#0F2B46'
            ></path>
          </svg>
        )
      default:
        icon = (
          <svg viewBox='0 0 1024 1024' width='24' height='24'>
            <path
              d='M512 512m-448 0a448 448 0 1 0 896 0 448 448 0 1 0-896 0Z'
              fill='#1890ff'
            ></path>
            <path
              d='M557.2 680.8h-90.4l-22.4 67.2h-68.8l102.4-292.8h68.8l102.4 292.8h-68.8l-23.2-67.2z m-76.8-56h63.2L512 539.2 480.4 624.8z'
              fill='#FFFFFF'
            ></path>
          </svg>
        )
    }

    // 判断是否需要配置
    const needsConfig = translators[key]?.requiredFields?.length > 0
    const { translatorConfigs } = window.services.getConfig() || {}
    const isConfigured = translatorConfigs[key]

    return (
      <div
        className={`translate__tab ${selectedTranslator === key ? 'translate__tab--active' : ''} ${needsConfig && !isConfigured ? 'translate__tab--not-configured' : ''}`}
        onClick={() =>
          handleTranslatorClick(key, name, needsConfig, isConfigured)
        }
        key={key}
        title={needsConfig && !isConfigured ? `${name} 需要配置API密钥` : name}
      >
        <div className='translate__tab-icon'>{icon}</div>
        <div className='translate__tab-name'>{name}</div>
      </div>
    )
  }

  return (
    <div className='translate__tabs'>
      {orderedTranslators.length > 0 ? (
        orderedTranslators.map(([key, translator]) =>
          renderTranslatorIcon(key, translator.name)
        )
      ) : (
        // 如果没有可用的翻译器，显示默认选项
        <div className='translate__tab translate__tab--empty'>
          <div className='translate__tab-icon'>
            <svg viewBox='0 0 1024 1024' width='24' height='24'>
              <path
                d='M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z'
                fill='#1890ff'
              ></path>
              <path
                d='M512 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176z'
                fill='#1890ff'
              ></path>
            </svg>
          </div>
          <div className='translate__tab-name'>请配置翻译服务</div>
        </div>
      )}
    </div>
  )
}

export default TranslatorTabs
